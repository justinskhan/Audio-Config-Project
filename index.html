<!DOCTYPE html> 
<html lang = "en"> 
<head> 
    <!-- Standard html template -->
    <title>Audio Config Project</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <!-- reference to css -->
    <link rel="stylesheet" href="style.css"/>
</head>
<body>
    <h1>Audio Speed Controller</h1>
    <input type="file" id="audioFileInput" accept="audio/*">
    <label for="audioSpeed">Adjust Speed:</label>
    <input type="range" id="audioSpeed" min="0.5" max="2.0" step="0.1" value="1">
    <audio id="audioPlayer" controls></audio>
    <button id="exportButton">Export Audio</button>

    <script>
        const audioPlayer = document.getElementById('audioPlayer');
        const audioSpeed = document.getElementById('audioSpeed');
        const audioFileInput = document.getElementById('audioFileInput');
        const exportButton = document.getElementById('exportButton');
        let audioContext, source, destination, mediaRecorder, recordedChunks;

        audioFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                audioPlayer.src = url;
                audioPlayer.load();
            }
        });

        audioSpeed.addEventListener('input', () => {
            audioPlayer.playbackRate = audioSpeed.value;
        });

        exportButton.addEventListener('click', async () => {
            if (!audioFileInput.files.length) {
                alert('Please select an audio file first.');
                return;
            }

            if (!audioContext) {
                audioContext = new AudioContext();
            }
            if (!source) {
                source = audioContext.createMediaElementSource(audioPlayer);
                destination = audioContext.createMediaStreamDestination();
                mediaRecorder = new MediaRecorder(destination.stream);
                recordedChunks = [];

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'audio/webm' });
                    const downloadLink = document.createElement('a');
                    downloadLink.href = URL.createObjectURL(blob);
                    downloadLink.download = 'exported_audio.webm';
                    downloadLink.click();
                };

                source.connect(audioContext.destination);
                source.connect(destination);
            }

            mediaRecorder.start();
            audioPlayer.play();

            setTimeout(() => {
                mediaRecorder.stop();
                audioPlayer.pause();
            }, audioPlayer.duration * 1000 / audioPlayer.playbackRate);
        });
    </script>
</body>
</html>